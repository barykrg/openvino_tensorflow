
    
 pool:
  name: 'Default'
  
 variables:
    WORK_DIR: /opt/intel/openvino_tensorflow
    BUILD_DIR: $(WORK_DIR)/build
    OV_LOCATION: /opt/intel/openvino_2021.3.394/
    
 steps:
 
   - script: |
      rm -rf $(WORK_DIR) ; mkdir $(WORK_DIR)
      rm -rf $(BUILD_DIR) ; mkdir $(BUILD_DIR)
      
   

   - script: |
      pip install -U pip yapf==0.26.0 pytest psutil keras==2.3.1
     displayName: "Setup" 
    
   - script: |
      export OPENVINO_TF_BACKEND=CPU
      echo $(WORK_DIR)
      git clone  https://github.com/openvinotoolkit/openvino_tensorflow.git /opt/intel/openvino_tensorflow
      git submodule init
      git submodule update
      python3 build_ovtf.py --use_tensorflow_from_location=/home/tf_m1 --use_openvino_from_location=$(OV_LOCATION) --disable_packaging_openvino_libs --cxx11_abi_version=1
     workingDirectory: $(WORK_DIR) 
     displayName: "Build"
     
   - script: |
      source $(WORK_DIR)/build_cmake/venv-tf-py3/bin/activate
      ./maint/check-code-format.sh
     workingDirectory: $(WORK_DIR) 
     displayName: "Code format check"
     
   - script: |
      rm -rf *
     displayName: "Cleanup"   
     workingDirectory: $(WORK_DIR)
